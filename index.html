<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ Panel Admin Pro - ALEXIS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #00d9ff;
            --success: #00ff41;
            --danger: #ff006e;
            --warning: #ff6b00;
            --info: #bd00ff;
            --dark: #0a0a0a;
            --card-bg: #1a1a1a;
            --gray: #2a2a2a;
            --gray-light: #3a3a3a;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--dark);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(189, 0, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 255, 65, 0.1) 0%, transparent 50%);
        }

        /* ============================================
           LOGIN SCREEN
           ============================================ */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--dark);
            z-index: 9999;
        }

        .login-box {
            background: var(--card-bg);
            padding: 50px 40px;
            border-radius: 20px;
            border: 1px solid rgba(189, 0, 255, 0.3);
            max-width: 400px;
            width: 100%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .login-logo {
            font-size: 4rem;
            margin-bottom: 20px;
            filter: drop-shadow(0 0 20px rgba(189, 0, 255, 0.5));
        }

        .login-title {
            font-size: 2rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--info), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .login-subtitle {
            color: #888;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #ccc;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .form-input {
            width: 100%;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #fff;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--info);
            box-shadow: 0 0 10px rgba(189, 0, 255, 0.3);
        }

        .btn-login {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--info), var(--success));
            border: none;
            border-radius: 8px;
            color: #fff;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s;
            margin-top: 10px;
        }

        .btn-login:hover {
            transform: translateY(-2px);
        }

        .error-msg {
            background: rgba(255, 0, 110, 0.2);
            border: 1px solid var(--danger);
            color: var(--danger);
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }

        /* ============================================
           MAIN PANEL - Usando los estilos del panel mejorado
           ============================================ */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: none;
        }

        .container.active {
            display: block;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 30px;
            background: linear-gradient(135deg, rgba(189, 0, 255, 0.1) 0%, rgba(0, 255, 65, 0.1) 100%);
            border-radius: 15px;
            border: 1px solid rgba(189, 0, 255, 0.2);
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-left h1 {
            font-size: 2rem;
            background: linear-gradient(135deg, var(--info), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-right {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .user-info {
            padding: 10px 20px;
            background: rgba(189, 0, 255, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(189, 0, 255, 0.3);
        }

        .btn-logout {
            padding: 10px 20px;
            background: rgba(255, 0, 110, 0.2);
            border: 1px solid var(--danger);
            color: var(--danger);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-logout:hover {
            background: rgba(255, 0, 110, 0.3);
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: var(--card-bg);
            padding: 10px;
            border-radius: 12px;
            border: 1px solid var(--gray);
            overflow-x: auto;
        }

        .tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            color: #888;
            cursor: pointer;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .tab.active {
            background: linear-gradient(135deg, var(--info), var(--success));
            color: #fff;
        }

        .tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Stats Cards */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid var(--gray);
            text-align: center;
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #888;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-card.primary .stat-number { color: var(--primary); }
        .stat-card.success .stat-number { color: var(--success); }
        .stat-card.danger .stat-number { color: var(--danger); }
        .stat-card.warning .stat-number { color: var(--warning); }
        .stat-card.info .stat-number { color: var(--info); }

        /* Quick Actions */
        .quick-actions {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--gray);
            margin-bottom: 30px;
        }

        .quick-actions h3 {
            margin-bottom: 15px;
            color: var(--info);
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .action-btn:hover {
            transform: translateY(-2px);
        }

        .action-btn.danger {
            background: rgba(255, 0, 110, 0.2);
            border: 1px solid var(--danger);
            color: var(--danger);
        }

        .action-btn.success {
            background: rgba(0, 255, 65, 0.2);
            border: 1px solid var(--success);
            color: var(--success);
        }

        .action-btn.warning {
            background: rgba(255, 107, 0, 0.2);
            border: 1px solid var(--warning);
            color: var(--warning);
        }

        .action-btn.info {
            background: rgba(189, 0, 255, 0.2);
            border: 1px solid var(--info);
            color: var(--info);
        }

        /* Search and Filters */
        .search-filter {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--gray);
            margin-bottom: 30px;
        }

        .search-box {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-input {
            flex: 1;
            min-width: 250px;
            padding: 12px 20px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #fff;
            font-size: 1rem;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--info);
        }

        .filter-select {
            padding: 12px 20px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
        }

        /* Projects List */
        .proyecto {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid var(--gray);
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .proyecto:hover {
            border-color: var(--info);
            box-shadow: 0 5px 20px rgba(189, 0, 255, 0.2);
        }

        .proyecto.inactivo {
            opacity: 0.7;
            border-color: var(--danger);
        }

        .proyecto.mantenimiento {
            border-color: var(--warning);
            background: linear-gradient(135deg, rgba(255, 107, 0, 0.05), transparent);
        }

        .proyecto-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .proyecto-titulo {
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--info), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .badges {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .badge {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge.activo {
            background: rgba(0, 255, 65, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .badge.inactivo {
            background: rgba(255, 0, 110, 0.2);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .badge.mantenimiento {
            background: rgba(255, 107, 0, 0.2);
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        .badge.pagado {
            background: rgba(189, 0, 255, 0.2);
            color: var(--info);
            border: 1px solid var(--info);
        }

        .proyecto-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .info-item {
            background: rgba(255, 255, 255, 0.02);
            padding: 12px;
            border-radius: 8px;
        }

        .info-label {
            color: #888;
            font-size: 0.85rem;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-value {
            color: #fff;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .controles {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-activar {
            background: rgba(0, 255, 65, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .btn-desactivar {
            background: rgba(255, 0, 110, 0.2);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .btn-tiempo {
            background: rgba(189, 0, 255, 0.2);
            color: var(--info);
            border: 1px solid var(--info);
        }

        .btn-editar {
            background: rgba(0, 217, 255, 0.2);
            color: var(--primary);
            border: 1px solid var(--primary);
        }

        .btn-warning {
            background: rgba(255, 107, 0, 0.2);
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid rgba(189, 0, 255, 0.3);
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--info), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .time-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .time-btn {
            padding: 15px;
            background: rgba(189, 0, 255, 0.1);
            border: 1px solid var(--info);
            color: var(--info);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .time-btn:hover {
            background: rgba(189, 0, 255, 0.2);
        }

        .time-btn.negative {
            background: rgba(255, 0, 110, 0.1);
            border-color: var(--danger);
            color: var(--danger);
        }

        .time-btn.negative:hover {
            background: rgba(255, 0, 110, 0.2);
        }

        /* Status Bar */
        .status-bar {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--card-bg);
            padding: 15px 25px;
            border-radius: 10px;
            border: 1px solid var(--gray);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-indicator.conectado {
            background: var(--success);
        }

        .status-indicator.error {
            background: var(--danger);
        }

        .status-indicator.guardando {
            background: var(--warning);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Activity Log */
        .activity-log {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid var(--gray);
            max-height: 500px;
            overflow-y: auto;
        }

        .activity-log h3 {
            color: var(--info);
            margin-bottom: 20px;
        }

        .log-item {
            padding: 15px;
            background: rgba(255, 255, 255, 0.02);
            border-left: 3px solid var(--info);
            border-radius: 6px;
            margin-bottom: 10px;
        }

        .log-time {
            color: #888;
            font-size: 0.85rem;
            margin-bottom: 5px;
        }

        .log-action {
            color: #fff;
            font-weight: 600;
        }

        /* Alerts Section */
        .alerts-section {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid var(--gray);
            margin-bottom: 30px;
        }

        .alert-item {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .alert-item.warning {
            background: rgba(255, 107, 0, 0.1);
            border: 1px solid var(--warning);
        }

        .alert-item.danger {
            background: rgba(255, 0, 110, 0.1);
            border: 1px solid var(--danger);
        }

        .alert-icon {
            font-size: 1.5rem;
        }

        /* Analytics - Clicks por D√≠a */
        .analytics-proyecto {
            background: var(--card-bg);
            border: 1px solid var(--gray);
            border-radius: 12px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        .analytics-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 22px;
            cursor: pointer;
            background: rgba(189,0,255,0.05);
            border-bottom: 1px solid var(--gray);
            flex-wrap: wrap;
            gap: 10px;
        }
        .analytics-header:hover {
            background: rgba(189,0,255,0.1);
        }
        .analytics-proyecto-nombre {
            font-size: 1.1rem;
            font-weight: 700;
            color: #fff;
        }
        .analytics-badges {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }
        .badge-hoy {
            background: rgba(0,255,65,0.15);
            border: 1px solid var(--success);
            color: var(--success);
            padding: 5px 14px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 700;
        }
        .badge-total {
            background: rgba(189,0,255,0.15);
            border: 1px solid var(--info);
            color: var(--info);
            padding: 5px 14px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 700;
        }
        .analytics-body {
            padding: 20px 22px;
        }
        .dias-tabla {
            width: 100%;
            border-collapse: collapse;
        }
        .dias-tabla th {
            text-align: left;
            color: #888;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 8px 10px;
            border-bottom: 1px solid var(--gray);
        }
        .dias-tabla td {
            padding: 10px 10px;
            border-bottom: 1px solid rgba(255,255,255,0.04);
            vertical-align: middle;
        }
        .dias-tabla tr:last-child td { border-bottom: none; }
        .dia-fecha {
            color: #ccc;
            font-size: 0.95rem;
            min-width: 120px;
        }
        .dia-barra-wrap {
            width: 100%;
        }
        .dia-barra-bg {
            background: var(--gray);
            border-radius: 20px;
            height: 14px;
            overflow: hidden;
        }
        .dia-barra {
            height: 100%;
            border-radius: 20px;
            background: linear-gradient(90deg, var(--info), var(--success));
            transition: width 0.4s ease;
            min-width: 4px;
        }
        .dia-num {
            text-align: right;
            font-weight: 700;
            color: var(--success);
            font-size: 1rem;
            min-width: 45px;
        }
        .sin-datos-dia {
            color: #555;
            text-align: center;
            padding: 20px;
            font-size: 0.9rem;
        }
        .click-reset-btn {
            padding: 5px 12px;
            background: rgba(255,0,110,0.15);
            border: 1px solid var(--danger);
            color: var(--danger);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.2s;
        }
        .click-reset-btn:hover { background: rgba(255,0,110,0.3); }
        .toggle-arrow {
            color: #888;
            font-size: 1rem;
            transition: transform 0.3s;
        }
        .analytics-proyecto.abierto .toggle-arrow {
            transform: rotate(180deg);
        }

        @media (max-width: 768px) {
            .stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .proyecto-info {
                grid-template-columns: 1fr;
            }

            .tabs {
                overflow-x: auto;
            }

            .header-right {
                width: 100%;
                justify-content: space-between;
            }
        }
    </style>
</head>
<body>

    <!-- ============================================
         LOGIN SCREEN
         ============================================ -->
    <div id="login-container" class="login-container">
        <div class="login-box">
            <div class="login-logo">üéÆ</div>
            <h1 class="login-title">Panel Admin ALEXIS</h1>
            <p class="login-subtitle">Sistema de Control de Proyectos</p>
            
            <div class="form-group">
                <label class="form-label">Usuario</label>
                <input type="text" id="username" class="form-input" placeholder="Ingresa tu usuario" onkeydown="if(event.key==='Enter') document.getElementById('password').focus()">
            </div>
            
            <div class="form-group">
                <label class="form-label">Contrase√±a</label>
                <input type="password" id="password" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" onkeydown="if(event.key==='Enter') login()">
            </div>
            
            <button class="btn-login" onclick="login()">üöÄ Iniciar Sesi√≥n</button>
            
            <div id="error-msg" class="error-msg">
                ‚ùå Usuario o contrase√±a incorrectos
            </div>

            <p style="margin-top: 30px; color: #666; font-size: 0.85rem;">
                üîí Acceso restringido
            </p>
        </div>
    </div>

    <!-- ============================================
         MAIN PANEL
         ============================================ -->
    <div id="main-container" class="container">
        
        <!-- Header -->
        <header>
            <div class="header-left">
                <h1>üéÆ Panel Admin ALEXIS</h1>
                <p style="color: #888;">Sistema de Control de Proyectos</p>
            </div>
            <div class="header-right">
                <div class="user-info">
                    üë§ <span id="usuario-nombre">Admin</span>
                </div>
                <button class="btn-logout" onclick="logout()">üö™ Salir</button>
            </div>
        </header>

        <!-- Stats Cards -->
        <div class="stats">
            <div class="stat-card info">
                <div class="stat-number" id="total-proyectos">0</div>
                <div class="stat-label">üìä Total Proyectos</div>
            </div>
            <div class="stat-card success">
                <div class="stat-number" id="activos">0</div>
                <div class="stat-label">‚úÖ Activos</div>
            </div>
            <div class="stat-card danger">
                <div class="stat-number" id="inactivos">0</div>
                <div class="stat-label">‚ùå Inactivos</div>
            </div>
            <div class="stat-card warning">
                <div class="stat-number" id="sin-pagar">0</div>
                <div class="stat-label">üí∞ Sin Pagar</div>
            </div>
            <div class="stat-card primary">
                <div class="stat-number" id="en-mantenimiento">0</div>
                <div class="stat-label">üîß Mantenimiento</div>
            </div>
            <div class="stat-card success">
                <div class="stat-number" id="total-clicks">0</div>
                <div class="stat-label">üõí Total Clicks</div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <h3>‚ö° Acciones R√°pidas</h3>
            <div class="action-buttons">
                <button class="action-btn warning" onclick="inicializarProyectos()" id="btn-inicializar" style="display:none; animation: pulse 2s infinite;">
                    üöÄ Inicializar Proyectos en Firebase
                </button>
                <button class="action-btn danger" onclick="bloquearNoPagados()">
                    üîí Bloquear sitios no pagados
                </button>
                <button class="action-btn success" onclick="activarPagados()">
                    ‚úÖ Activar sitios pagados
                </button>
                <button class="action-btn warning" onclick="alertarProximosVencer()">
                    ‚è∞ Ver pr√≥ximos a vencer
                </button>
                <button class="action-btn info" onclick="exportarReporte()">
                    üì• Exportar reporte
                </button>
                <button class="action-btn info" onclick="limpiarHistorial()">
                    üóëÔ∏è Limpiar historial
                </button>
                <button class="action-btn success" onclick="abrirModalNuevoProyecto()">
                    ‚ûï Nuevo Proyecto
                </button>
            </div>
        </div>

        <!-- Tabs Navigation -->
        <div class="tabs">
            <button class="tab active" onclick="cambiarTab('proyectos')">üìÅ Proyectos</button>
            <button class="tab" onclick="cambiarTab('historial')">üìú Historial</button>
            <button class="tab" onclick="cambiarTab('alertas')">‚ö†Ô∏è Alertas</button>
            <button class="tab" onclick="cambiarTab('analytics')">üìä Clicks Compra</button>
            <button class="tab" onclick="cambiarTab('usuarios')">üë§ Usuarios</button>
        </div>

        <!-- TAB: Proyectos -->
        <div id="tab-proyectos" class="tab-content active">
            <!-- Search and Filter -->
            <div class="search-filter">
                <div class="search-box">
                    <input type="text" class="search-input" id="search-input" 
                           placeholder="üîç Buscar proyecto..." 
                           oninput="filtrarProyectos()">
                    <select class="filter-select" id="filter-estado" onchange="filtrarProyectos()">
                        <option value="todos">Todos</option>
                        <option value="activos">Activos</option>
                        <option value="inactivos">Inactivos</option>
                        <option value="pagados">Pagados</option>
                        <option value="no-pagados">No Pagados</option>
                        <option value="mantenimiento">En Mantenimiento</option>
                    </select>
                </div>
            </div>

            <!-- Projects List -->
            <div id="proyectos-lista"></div>
        </div>

        <!-- TAB: Historial -->
        <div id="tab-historial" class="tab-content">
            <div class="activity-log">
                <h3>üìú Historial de Actividad</h3>
                <div id="log-container"></div>
            </div>
        </div>

        <!-- TAB: Alertas -->
        <div id="tab-alertas" class="tab-content">
            <div class="alerts-section">
                <h3>‚ö†Ô∏è Alertas y Notificaciones</h3>
                <div id="alertas-container"></div>
            </div>
        </div>

        <!-- TAB: Usuarios -->
        <div id="tab-usuarios" class="tab-content">
            <div class="alerts-section" style="margin-bottom:20px;">
                <h3 style="margin-bottom:20px;">‚ûï Agregar Nuevo Usuario</h3>
                <div style="display:grid; gap:15px; max-width:500px;">
                    <div class="form-group" style="margin-bottom:0;">
                        <label class="form-label">Usuario</label>
                        <input type="text" id="nuevo-usuario" class="form-input" placeholder="Ej: CARLOS">
                    </div>
                    <div class="form-group" style="margin-bottom:0;">
                        <label class="form-label">Contrase√±a</label>
                        <input type="password" id="nueva-contrasena" class="form-input" placeholder="Contrase√±a segura">
                    </div>
                    <div class="form-group" style="margin-bottom:0;">
                        <label class="form-label">Repetir Contrase√±a</label>
                        <input type="password" id="repetir-contrasena" class="form-input" placeholder="Repite la contrase√±a">
                    </div>
                    <button class="action-btn success" style="width:fit-content;" onclick="agregarUsuario()">
                        üíæ Guardar Usuario
                    </button>
                    <div id="msg-usuarios" style="display:none; padding:12px; border-radius:8px; font-weight:600;"></div>
                </div>
            </div>
            <div class="alerts-section">
                <h3 style="margin-bottom:20px;">üë• Usuarios Guardados</h3>
                <div id="lista-usuarios"></div>
            </div>
        </div>
            <div class="alerts-section">
                <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:10px; margin-bottom:20px;">
                    <div>
                        <h3>üõí Clicks por D√≠a en Bot√≥n de Compra</h3>
                        <p style="color:#888; margin-top:6px; font-size:0.9rem;">Cu√°ntas personas apretaron "Comprar" cada d√≠a en cada proyecto.</p>
                    </div>
                    <select id="filtro-dias" class="filter-select" onchange="renderAnalytics()" style="height:42px;">
                        <option value="7">√öltimos 7 d√≠as</option>
                        <option value="30" selected>√öltimos 30 d√≠as</option>
                        <option value="90">√öltimos 90 d√≠as</option>
                        <option value="0">Todos los d√≠as</option>
                    </select>
                </div>
                <div id="analytics-container"></div>
            </div>
        </div>
    <div class="status-bar">
        <div class="status-indicator conectado" id="status-indicator"></div>
        <span id="status-text">üü¢ Firebase conectado</span>
    </div>

    <!-- Modal: Agregar Tiempo -->
    <div id="modalTiempo" class="modal">
        <div class="modal-content">
            <h2 class="modal-title">‚è∞ Gestionar Tiempo</h2>
            <p style="margin-bottom: 20px;">Proyecto: <strong id="proyectoNombre"></strong></p>
            
            <h4 style="color: var(--success); margin-bottom: 10px;">‚ûï Agregar Tiempo</h4>
            <div class="time-options">
                <button class="time-btn" onclick="agregarTiempo(7)">+7 d√≠as</button>
                <button class="time-btn" onclick="agregarTiempo(15)">+15 d√≠as</button>
                <button class="time-btn" onclick="agregarTiempo(30)">+30 d√≠as</button>
                <button class="time-btn" onclick="agregarTiempo(60)">+60 d√≠as</button>
            </div>

            <h4 style="color: var(--danger); margin-bottom: 10px; margin-top: 20px;">‚ûñ Quitar Tiempo</h4>
            <div class="time-options">
                <button class="time-btn negative" onclick="agregarTiempo(-7)">-7 d√≠as</button>
                <button class="time-btn negative" onclick="agregarTiempo(-15)">-15 d√≠as</button>
                <button class="time-btn negative" onclick="agregarTiempo(-30)">-30 d√≠as</button>
                <button class="time-btn negative" onclick="agregarTiempo(-60)">-60 d√≠as</button>
            </div>

            <div style="margin-top: 20px;">
                <label style="color: #888; display: block; margin-bottom: 5px;">D√≠as personalizados:</label>
                <input type="number" id="diasCustom" class="form-input" 
                       placeholder="Ej: 45 (positivo) o -45 (negativo)">
            </div>

            <div class="modal-buttons">
                <button class="btn btn-tiempo" onclick="agregarTiempoCustom()">‚úì Aplicar Custom</button>
                <button class="btn btn-desactivar" onclick="cerrarModal()">‚úó Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal: Nuevo Proyecto -->
    <div id="modalNuevoProyecto" class="modal">
        <div class="modal-content" style="max-width:560px;">
            <h2 class="modal-title">‚ûï Nuevo Proyecto</h2>
            <div style="display:grid; gap:14px;">
                <div>
                    <label class="form-label">ID del Proyecto (sin espacios)</label>
                    <input type="text" id="np-id" class="form-input" placeholder="Ej: modsljak_android">
                    <small style="color:#666; font-size:0.8rem;">‚ö†Ô∏è Debe coincidir con el MODSLJAK_PROYECTO_ID del sitio</small>
                </div>
                <div>
                    <label class="form-label">Nombre visible</label>
                    <input type="text" id="np-nombre" class="form-input" placeholder="Ej: MODSLJAK Android">
                </div>
                <div>
                    <label class="form-label">Cliente / Due√±o</label>
                    <input type="text" id="np-cliente" class="form-input" placeholder="Ej: Victor">
                </div>
                <div>
                    <label class="form-label">URL del sitio</label>
                    <input type="text" id="np-url" class="form-input" placeholder="https://misitio.com/android.html">
                </div>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:14px;">
                    <div>
                        <label class="form-label">Precio mensual</label>
                        <input type="text" id="np-precio" class="form-input" placeholder="Ej: $20/mes">
                    </div>
                    <div>
                        <label class="form-label">Fecha expiraci√≥n</label>
                        <input type="date" id="np-expira" class="form-input">
                    </div>
                </div>
                <div style="display:flex; gap:20px;">
                    <label style="display:flex; align-items:center; gap:8px; cursor:pointer; color:#ccc;">
                        <input type="checkbox" id="np-activo" checked style="width:16px; height:16px;"> Activo
                    </label>
                    <label style="display:flex; align-items:center; gap:8px; cursor:pointer; color:#ccc;">
                        <input type="checkbox" id="np-pagado" checked style="width:16px; height:16px;"> Pagado
                    </label>
                </div>
            </div>
            <div id="np-msg" style="display:none; padding:12px; border-radius:8px; margin-top:15px; font-weight:600;"></div>
            <div class="modal-buttons" style="margin-top:20px;">
                <button class="btn btn-activar" onclick="guardarNuevoProyecto()">üíæ Crear Proyecto</button>
                <button class="btn btn-desactivar" onclick="cerrarModalNuevoProyecto()">‚úó Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURACI√ìN FIREBASE REAL - CONFIGURADO ‚úì
        // ============================================
        
        // Importar Firebase SDK
        const firebaseScript = document.createElement('script');
        firebaseScript.src = 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js';
        document.head.appendChild(firebaseScript);
        
        const firebaseDbScript = document.createElement('script');
        firebaseDbScript.src = 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js';
        document.head.appendChild(firebaseDbScript);

        // Configuraci√≥n completa de Firebase
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyBeNbkwo2M8xsxZPmfwCI2wRUnAg1mhGaU",
            authDomain: "alexis-fba4d.firebaseapp.com",
            databaseURL: 'https://alexis-fba4d-default-rtdb.firebaseio.com',
            projectId: "alexis-fba4d",
            storageBucket: "alexis-fba4d.firebasestorage.app",
            messagingSenderId: "951108944538",
            appId: "1:951108944538:web:f09df349c41518de385523"
        };

        const DB_URL = FIREBASE_CONFIG.databaseURL + '/proyectos';
        
        // Inicializar Firebase cuando los scripts est√©n cargados
        let firebaseInitialized = false;
        let database = null;
        
        firebaseDbScript.onload = () => {
            if (!firebaseInitialized) {
                firebase.initializeApp(FIREBASE_CONFIG);
                database = firebase.database();
                firebaseInitialized = true;
                console.log('‚úÖ Firebase inicializado correctamente');
            }
        };

        // ============================================
        // CREDENCIALES - HASH SHA-256 (NO EDITAR)
        // ============================================

        const _h = {
            '\x37\x65\x37\x65\x38\x62\x30\x30\x37\x64\x31\x61\x63\x32\x38\x30\x66\x63\x61\x30\x31\x38\x65\x34\x30\x33\x31\x66\x63\x65\x36\x38\x61\x64\x39\x32\x39\x30\x36\x64\x38\x32\x34\x33\x31\x31\x32\x35\x38\x32\x64\x32\x37\x30\x35\x32\x33\x64\x63\x31\x38\x31\x37\x36':
            '\x38\x38\x39\x31\x64\x39\x34\x65\x61\x32\x30\x33\x32\x36\x37\x63\x63\x66\x64\x34\x33\x34\x38\x39\x62\x32\x33\x64\x65\x34\x39\x63\x33\x35\x62\x35\x65\x33\x64\x61\x62\x61\x61\x62\x62\x66\x35\x38\x66\x64\x39\x35\x36\x66\x63\x30\x37\x61\x64\x38\x63\x32\x66\x34'
        };

        async function _sha256(str) {
            const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(str));
            return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,'0')).join('');
        }

        let proyectosData = {};
        let proyectoActual = null;
        let activityLog = JSON.parse(localStorage.getItem('activityLog') || '[]');

        // ============================================
        // LOGIN
        // ============================================

        async function login() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;

            if (!username || !password) {
                document.getElementById('error-msg').style.display = 'block';
                return;
            }

            const hUser = await _sha256(username);
            const hPass = await _sha256(password);

            // Verificar usuario principal (hardcoded) + usuarios extras guardados
            const usuariosExtras = JSON.parse(localStorage.getItem('_usuarios_extras') || '{}');
            const esValido = (_h[hUser] && _h[hUser] === hPass) || 
                             (usuariosExtras[hUser] && usuariosExtras[hUser] === hPass);

            if (esValido) {
                document.getElementById('login-container').style.display = 'none';
                document.getElementById('main-container').classList.add('active');
                document.getElementById('usuario-nombre').textContent = username;
                localStorage.setItem('usuario', username);
                document.getElementById('error-msg').style.display = 'none';
                agregarLog(`‚úÖ Inicio de sesi√≥n: ${username}`);
                cargarProyectos();
            } else {
                document.getElementById('error-msg').style.display = 'block';
            }
        }

        function logout() {
            if (confirm('¬øEst√°s seguro de cerrar sesi√≥n?')) {
                localStorage.removeItem('usuario');
                document.getElementById('login-container').style.display = 'flex';
                document.getElementById('main-container').classList.remove('active');
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                document.getElementById('error-msg').style.display = 'none';
                agregarLog('üëã Sesi√≥n cerrada');
            }
        }

        window.onload = async function() {
            // Siempre mostrar login primero
            document.getElementById('login-container').style.display = 'flex';
            document.getElementById('main-container').classList.remove('active');

            const usuario = localStorage.getItem('usuario');
            if (!usuario) return;

            const hUser = await _sha256(usuario);
            const usuariosExtras = JSON.parse(localStorage.getItem('_usuarios_extras') || '{}');
            const esValido = _h[hUser] || usuariosExtras[hUser];

            if (esValido) {
                document.getElementById('login-container').style.display = 'none';
                document.getElementById('main-container').classList.add('active');
                document.getElementById('usuario-nombre').textContent = usuario;
                cargarProyectos();
            } else {
                localStorage.removeItem('usuario');
            }
        };

        // ============================================
        // TABS
        // ============================================

        function cambiarTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            document.getElementById(`tab-${tabName}`).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'historial') {
                renderHistorial();
            } else if (tabName === 'alertas') {
                generarAlertas();
            } else if (tabName === 'analytics') {
                renderAnalytics();
            } else if (tabName === 'usuarios') {
                renderUsuarios();
            }
        }

        // ============================================
        // CARGAR PROYECTOS DESDE FIREBASE
        // ============================================

        function setStatus(tipo, mensaje) {
            const indicator = document.getElementById('status-indicator');
            const text = document.getElementById('status-text');
            indicator.className = `status-indicator ${tipo}`;
            text.textContent = mensaje;
        }

        function cargarProyectos() {
            setStatus('guardando', '‚è≥ Cargando desde Firebase...');

            fetch(DB_URL + '.json')
                .then(r => {
                    if (!r.ok) throw new Error('HTTP ' + r.status);
                    return r.json();
                })
                .then(data => {
                    proyectosData = data || {};
                    
                    // Verificar si la base de datos est√° vac√≠a
                    if (Object.keys(proyectosData).length === 0) {
                        setStatus('error', '‚ö†Ô∏è Base de datos vac√≠a - Inicializar proyectos');
                        document.getElementById('btn-inicializar').style.display = 'block';
                        document.getElementById('proyectos-container').innerHTML = `
                            <div style="text-align: center; padding: 60px; background: rgba(255,107,0,0.1); border: 2px solid var(--warning); border-radius: 15px; margin: 20px 0;">
                                <h2 style="color: var(--warning); margin-bottom: 20px;">‚ö†Ô∏è Base de Datos Vac√≠a</h2>
                                <p style="color: #ccc; font-size: 1.1rem; margin-bottom: 15px;">No hay proyectos registrados en Firebase.</p>
                                <p style="color: #888;">Haz clic en el bot√≥n <strong style="color: var(--warning);">"üöÄ Inicializar Proyectos"</strong> arriba para crear autom√°ticamente:</p>
                                <ul style="text-align: left; display: inline-block; margin: 20px auto; color: #ccc;">
                                    <li style="margin: 10px 0;">‚úì MODSLJAK Victor (modsljak_victor)</li>
                                    <li style="margin: 10px 0;">‚úì EMERSON HACKS (modsljak_emerson)</li>
                                </ul>
                            </div>
                        `;
                    } else {
                        setStatus('conectado', 'üü¢ Conectado a Firebase');
                        document.getElementById('btn-inicializar').style.display = 'none';
                        renderProyectos(proyectosData);
                        actualizarEstadisticas(proyectosData);
                        generarAlertas();
                    }
                })
                .catch(error => {
                    setStatus('error', '‚ùå Error: ' + error.message);
                    console.error('Error Firebase:', error);
                    alert('‚ö†Ô∏è Error al conectar con Firebase.\nRevisa la consola para m√°s detalles.');
                });
        }

        // ============================================
        // GUARDAR CAMBIOS EN FIREBASE
        // ============================================

        function guardarCambios() {
            setStatus('guardando', 'üíæ Guardando en Firebase...');

            fetch(DB_URL + '.json', {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(proyectosData)
            })
            .then(r => {
                if (!r.ok) throw new Error('HTTP ' + r.status);
                return r.json();
            })
            .then(() => {
                setStatus('conectado', '‚úÖ Guardado en Firebase');
                renderProyectos(proyectosData);
                actualizarEstadisticas(proyectosData);
                generarAlertas();
                setTimeout(() => setStatus('conectado', 'üü¢ Conectado a Firebase'), 3000);
            })
            .catch(error => {
                setStatus('error', '‚ùå Error al guardar: ' + error.message);
                console.error('Error:', error);
                alert('‚ö†Ô∏è Error al guardar en Firebase.\nRevisa la consola para m√°s detalles.');
            });
        }

        // ============================================
        // INICIALIZAR PROYECTOS AUTOM√ÅTICAMENTE
        // ============================================
        
        function inicializarProyectos() {
            const confirmar = confirm(
                'üöÄ INICIALIZAR PROYECTOS EN FIREBASE\n\n' +
                'Se crear√°n autom√°ticamente:\n\n' +
                '‚úì MODSLJAK Victor (modsljak_victor)\n' +
                '‚úì EMERSON HACKS (modsljak_emerson)\n\n' +
                'Ambos proyectos estar√°n:\n' +
                '- Activos ‚úÖ\n' +
                '- Pagados ‚úÖ\n' +
                '- Expiran: 2026-03-15 (30 d√≠as)\n\n' +
                '¬øContinuar?'
            );
            
            if (!confirmar) return;
            
            setStatus('guardando', 'üöÄ Inicializando proyectos...');
            
            const PROYECTOS_INICIALES = {
                "modsljak_victor": {
                    "nombre": "MODSLJAK Victor",
                    "cliente": "Victor",
                    "url_demo": "https://torhshwvve.github.io/VicleyStore/",
                    "precio": "$20/mes",
                    "expira": "2026-03-15",
                    "activo": true,
                    "pagado": true,
                    "mantenimiento": false,
                    "ultima_actualizacion": "2026-02-13",
                    "clics_compra": 0,
                    "clics_por_dia": {}
                },
                "modsljak_emerson": {
                    "nombre": "EMERSON HACKS",
                    "cliente": "Emerson",
                    "url_demo": "https://torhshwvve.github.io/emersonhacks/",
                    "precio": "$20/mes",
                    "expira": "2026-03-15",
                    "activo": true,
                    "pagado": true,
                    "mantenimiento": false,
                    "ultima_actualizacion": "2026-02-13",
                    "clics_compra": 0,
                    "clics_por_dia": {}
                }
            };
            
            fetch(DB_URL + '.json', {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(PROYECTOS_INICIALES)
            })
            .then(r => {
                if (!r.ok) throw new Error('HTTP ' + r.status);
                return r.json();
            })
            .then(() => {
                setStatus('conectado', '‚úÖ ¬°Proyectos inicializados correctamente!');
                agregarLog('üöÄ Proyectos iniciales creados: MODSLJAK Victor y EMERSON HACKS');
                
                alert(
                    '‚úÖ ¬°PROYECTOS CREADOS EXITOSAMENTE!\n\n' +
                    'Se han inicializado:\n\n' +
                    '‚úì MODSLJAK Victor\n' +
                    '‚úì EMERSON HACKS\n\n' +
                    'Ahora tus p√°ginas web se conectar√°n correctamente.\n\n' +
                    'Recarga tus sitios web para verificar la conexi√≥n.'
                );
                
                setTimeout(() => {
                    cargarProyectos();
                }, 2000);
            })
            .catch(error => {
                setStatus('error', '‚ùå Error al inicializar: ' + error.message);
                console.error('Error:', error);
                alert('‚ö†Ô∏è Error al inicializar proyectos.\nRevisa la consola para m√°s detalles.');
            });
        }

        // ============================================
        // RENDER PROYECTOS
        // ============================================

        function renderProyectos(proyectos) {
            const lista = document.getElementById('proyectos-lista');
            lista.innerHTML = '';

            for (let [id, proyecto] of Object.entries(proyectos)) {
                const expira = new Date(proyecto.expira);
                const hoy = new Date();
                const diasRestantes = Math.ceil((expira - hoy) / (1000 * 60 * 60 * 24));
                
                const clases = ['proyecto'];
                if (!proyecto.activo) clases.push('inactivo');
                if (proyecto.mantenimiento) clases.push('mantenimiento');

                const div = document.createElement('div');
                div.className = clases.join(' ');
                div.setAttribute('data-id', id);
                div.innerHTML = `
                    <div class="proyecto-header">
                        <div>
                            <div class="proyecto-titulo">${proyecto.nombre}</div>
                            <div style="color: #888; margin-top: 5px;">Cliente: ${proyecto.cliente} ‚Ä¢ ID: ${id}</div>
                        </div>
                        <div class="badges">
                            <span class="badge ${proyecto.activo ? 'activo' : 'inactivo'}">
                                ${proyecto.activo ? '‚úÖ Activo' : '‚ùå Inactivo'}
                            </span>
                            ${proyecto.mantenimiento ? '<span class="badge mantenimiento">üîß Mantenimiento</span>' : ''}
                            ${proyecto.pagado ? '<span class="badge pagado">üí≥ Pagado</span>' : ''}
                        </div>
                    </div>

                    <div class="proyecto-info">
                        <div class="info-item">
                            <div class="info-label">üí∞ Precio</div>
                            <div class="info-value">${proyecto.precio}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">üí≥ Estado Pago</div>
                            <div class="info-value" style="color: ${proyecto.pagado ? 'var(--success)' : 'var(--danger)'};">
                                ${proyecto.pagado ? 'Pagado ‚úì' : 'Pendiente ‚úó'}
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">üìÖ Expira</div>
                            <div class="info-value">
                                ${proyecto.expira}
                                <div style="font-size: 0.85rem; color: ${diasRestantes <= 7 ? 'var(--warning)' : diasRestantes <= 0 ? 'var(--danger)' : '#888'};">
                                    ${diasRestantes > 0 ? `(${diasRestantes} d√≠as)` : '(‚ö†Ô∏è Expirado)'}
                                </div>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">üõí Clicks Hoy / Total</div>
                            <div class="info-value" style="color: var(--success);">
                                ${(() => {
                                    const hoy = new Date().toISOString().split('T')[0];
                                    const dias = proyecto.clics_por_dia || {};
                                    const hoyN = dias[hoy] || 0;
                                    const total = Object.values(dias).reduce((a,b) => a+b, 0);
                                    return `${hoyN} hoy / ${total} total`;
                                })()}
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">üîÑ Actualizado</div>
                            <div class="info-value">${proyecto.ultima_actualizacion}</div>
                        </div>
                    </div>

                    <div class="controles">
                        <button class="btn ${proyecto.activo ? 'btn-desactivar' : 'btn-activar'}" 
                                onclick="toggleActivacion('${id}', ${!proyecto.activo})">
                            ${proyecto.activo ? 'üî¥ Desactivar' : 'üü¢ Activar'}
                        </button>
                        <button class="btn btn-warning" 
                                onclick="toggleMantenimiento('${id}', ${!proyecto.mantenimiento})">
                            ${proyecto.mantenimiento ? 'üîß Quitar Mantenimiento' : 'üîß Mantenimiento'}
                        </button>
                        <button class="btn btn-tiempo" onclick="abrirModalTiempo('${id}')">
                            ‚è∞ Gestionar Tiempo
                        </button>
                        <button class="btn btn-editar" onclick="togglePago('${id}', ${!proyecto.pagado})">
                            ${proyecto.pagado ? 'üí≥ No Pagado' : 'üí∞ Pagado'}
                        </button>
                        <a href="${proyecto.url_demo}" class="btn btn-editar" target="_blank" style="text-decoration: none;">
                            üåê Ver Sitio
                        </a>
                    </div>
                `;
                lista.appendChild(div);
            }
        }

        function actualizarEstadisticas(proyectos) {
            const total = Object.keys(proyectos).length;
            let activos = 0, inactivos = 0, sinPagar = 0, enMantenimiento = 0, totalClicks = 0;

            for (let [id, p] of Object.entries(proyectos)) {
                if (p.activo) activos++; else inactivos++;
                if (!p.pagado) sinPagar++;
                if (p.mantenimiento) enMantenimiento++;
                if (p.clics_por_dia) totalClicks += Object.values(p.clics_por_dia).reduce((a,b) => a+b, 0);
            }

            document.getElementById('total-proyectos').textContent = total;
            document.getElementById('activos').textContent = activos;
            document.getElementById('inactivos').textContent = inactivos;
            document.getElementById('sin-pagar').textContent = sinPagar;
            document.getElementById('en-mantenimiento').textContent = enMantenimiento;
            document.getElementById('total-clicks').textContent = totalClicks;
        }

        // ============================================
        // FUNCIONES DE CONTROL
        // ============================================

        function toggleActivacion(id, nuevoEstado) {
            const proyecto = proyectosData[id];
            const accion = nuevoEstado ? 'activar' : 'desactivar';
            if (confirm(`¬ø${accion.toUpperCase()} "${proyecto.nombre}"?`)) {
                proyectosData[id].activo = nuevoEstado;
                proyectosData[id].ultima_actualizacion = new Date().toISOString().split('T')[0];
                agregarLog(`${nuevoEstado ? '‚úÖ' : '‚ùå'} ${accion.toUpperCase()}: ${proyecto.nombre}`);
                guardarCambios();
            }
        }

        function toggleMantenimiento(id, nuevoEstado) {
            const proyecto = proyectosData[id];
            if (confirm(`¬ø${nuevoEstado ? 'Activar' : 'Desactivar'} mantenimiento en "${proyecto.nombre}"?`)) {
                proyectosData[id].mantenimiento = nuevoEstado;
                proyectosData[id].ultima_actualizacion = new Date().toISOString().split('T')[0];
                agregarLog(`üîß Mantenimiento ${nuevoEstado ? 'activado' : 'desactivado'}: ${proyecto.nombre}`);
                guardarCambios();
            }
        }

        function togglePago(id, nuevoPago) {
            proyectosData[id].pagado = nuevoPago;
            proyectosData[id].ultima_actualizacion = new Date().toISOString().split('T')[0];
            agregarLog(`üí∞ ${nuevoPago ? 'Pagado' : 'No pagado'}: ${proyectosData[id].nombre}`);
            guardarCambios();
        }

        function abrirModalTiempo(id) {
            proyectoActual = id;
            document.getElementById('proyectoNombre').textContent = proyectosData[id].nombre;
            document.getElementById('modalTiempo').classList.add('active');
        }

        function cerrarModal() {
            document.getElementById('modalTiempo').classList.remove('active');
            document.getElementById('diasCustom').value = '';
        }

        function agregarTiempo(dias) {
            if (!proyectoActual) return;
            const proyecto = proyectosData[proyectoActual];
            const fechaActual = new Date(proyecto.expira);
            fechaActual.setDate(fechaActual.getDate() + dias);
            proyectosData[proyectoActual].expira = fechaActual.toISOString().split('T')[0];
            proyectosData[proyectoActual].ultima_actualizacion = new Date().toISOString().split('T')[0];
            
            agregarLog(`‚è∞ ${dias > 0 ? 'Agregados' : 'Removidos'} ${Math.abs(dias)} d√≠as: ${proyecto.nombre}`);
            
            cerrarModal();
            guardarCambios();
            alert(`‚úÖ ${dias > 0 ? '+' : ''}${dias} d√≠as ‚Üí Nueva fecha: ${fechaActual.toLocaleDateString('es-ES')}`);
        }

        function agregarTiempoCustom() {
            const dias = parseInt(document.getElementById('diasCustom').value);
            if (dias && !isNaN(dias)) {
                agregarTiempo(dias);
            } else {
                alert('‚ö†Ô∏è Ingresa un n√∫mero v√°lido');
            }
        }

        // ============================================
        // ACCIONES R√ÅPIDAS
        // ============================================

        function bloquearNoPagados() {
            if (!confirm('¬øDesactivar TODOS los sitios no pagados?')) return;
            
            let count = 0;
            for (let [id, proyecto] of Object.entries(proyectosData)) {
                if (!proyecto.pagado && proyecto.activo) {
                    proyectosData[id].activo = false;
                    proyectosData[id].ultima_actualizacion = new Date().toISOString().split('T')[0];
                    count++;
                }
            }
            
            agregarLog(`üîí Bloqueados ${count} sitios no pagados`);
            guardarCambios();
            alert(`‚úÖ ${count} sitios bloqueados`);
        }

        function activarPagados() {
            if (!confirm('¬øActivar TODOS los sitios pagados?')) return;
            
            let count = 0;
            for (let [id, proyecto] of Object.entries(proyectosData)) {
                if (proyecto.pagado && !proyecto.activo) {
                    proyectosData[id].activo = true;
                    proyectosData[id].ultima_actualizacion = new Date().toISOString().split('T')[0];
                    count++;
                }
            }
            
            agregarLog(`‚úÖ Activados ${count} sitios pagados`);
            guardarCambios();
            alert(`‚úÖ ${count} sitios activados`);
        }

        function alertarProximosVencer() {
            const hoy = new Date();
            const proximos = [];
            
            for (let [id, proyecto] of Object.entries(proyectosData)) {
                const expira = new Date(proyecto.expira);
                const dias = Math.ceil((expira - hoy) / (1000 * 60 * 60 * 24));
                if (dias <= 15 && dias >= 0) {
                    proximos.push(`${proyecto.nombre}: ${dias} d√≠as`);
                }
            }
            
            if (proximos.length === 0) {
                alert('‚úÖ No hay proyectos pr√≥ximos a vencer');
            } else {
                alert(`‚ö†Ô∏è Pr√≥ximos a vencer:\n\n${proximos.join('\n')}`);
            }
        }

        function exportarReporte() {
            const reporte = {
                fecha: new Date().toISOString(),
                proyectos: proyectosData,
                historial: activityLog
            };
            
            const blob = new Blob([JSON.stringify(reporte, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `reporte-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            
            agregarLog('üì• Reporte exportado');
            alert('‚úÖ Reporte exportado');
        }

        function limpiarHistorial() {
            if (confirm('¬øLimpiar historial de actividad?')) {
                activityLog = [];
                localStorage.setItem('activityLog', JSON.stringify(activityLog));
                renderHistorial();
                alert('‚úÖ Historial limpiado');
            }
        }

        // ============================================
        // HISTORIAL
        // ============================================

        function agregarLog(accion) {
            const log = {
                fecha: new Date().toISOString(),
                accion: accion,
                usuario: document.getElementById('usuario-nombre').textContent
            };
            activityLog.unshift(log);
            
            if (activityLog.length > 100) {
                activityLog = activityLog.slice(0, 100);
            }
            
            localStorage.setItem('activityLog', JSON.stringify(activityLog));
        }

        function renderHistorial() {
            const container = document.getElementById('log-container');
            container.innerHTML = '';
            
            if (activityLog.length === 0) {
                container.innerHTML = '<p style="color: #888; text-align: center; padding: 20px;">No hay actividad</p>';
                return;
            }
            
            activityLog.forEach(log => {
                const div = document.createElement('div');
                div.className = 'log-item';
                div.innerHTML = `
                    <div class="log-time">${new Date(log.fecha).toLocaleString('es-ES')}</div>
                    <div class="log-action">${log.accion}</div>
                    <div style="color: #666; font-size: 0.85rem; margin-top: 5px;">Por: ${log.usuario}</div>
                `;
                container.appendChild(div);
            });
        }

        // ============================================
        // ALERTAS
        // ============================================

        function generarAlertas() {
            const container = document.getElementById('alertas-container');
            container.innerHTML = '';
            
            const hoy = new Date();
            const alertas = [];
            
            for (let [id, proyecto] of Object.entries(proyectosData)) {
                const expira = new Date(proyecto.expira);
                const dias = Math.ceil((expira - hoy) / (1000 * 60 * 60 * 24));
                
                if (dias < 0 && proyecto.activo) {
                    alertas.push({
                        tipo: 'danger',
                        icono: 'üö®',
                        mensaje: `${proyecto.nombre} EXPIRADO hace ${Math.abs(dias)} d√≠as`
                    });
                }
                else if (dias <= 7 && dias >= 0) {
                    alertas.push({
                        tipo: 'warning',
                        icono: '‚ö†Ô∏è',
                        mensaje: `${proyecto.nombre} vence en ${dias} d√≠as`
                    });
                }
                
                if (!proyecto.pagado && proyecto.activo) {
                    alertas.push({
                        tipo: 'warning',
                        icono: 'üí∞',
                        mensaje: `${proyecto.nombre} activo pero NO pagado`
                    });
                }
            }
            
            if (alertas.length === 0) {
                container.innerHTML = '<p style="color: #888; text-align: center; padding: 20px;">‚úÖ No hay alertas</p>';
                return;
            }
            
            alertas.forEach(alerta => {
                container.innerHTML += `
                    <div class="alert-item ${alerta.tipo}">
                        <div class="alert-icon">${alerta.icono}</div>
                        <div>${alerta.mensaje}</div>
                    </div>
                `;
            });
        }

        // ============================================
        // FILTROS
        // ============================================

        function filtrarProyectos() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const filtroEstado = document.getElementById('filter-estado').value;
            
            const proyectos = document.querySelectorAll('.proyecto');
            
            proyectos.forEach(div => {
                const id = div.getAttribute('data-id');
                const proyecto = proyectosData[id];
                
                const textoProyecto = `${proyecto.nombre} ${proyecto.cliente} ${id}`.toLowerCase();
                const coincideBusqueda = textoProyecto.includes(searchTerm);
                
                let coincideFiltro = true;
                if (filtroEstado === 'activos') coincideFiltro = proyecto.activo;
                else if (filtroEstado === 'inactivos') coincideFiltro = !proyecto.activo;
                else if (filtroEstado === 'pagados') coincideFiltro = proyecto.pagado;
                else if (filtroEstado === 'no-pagados') coincideFiltro = !proyecto.pagado;
                else if (filtroEstado === 'mantenimiento') coincideFiltro = proyecto.mantenimiento;
                
                div.style.display = (coincideBusqueda && coincideFiltro) ? 'block' : 'none';
            });
        }
        // ============================================
        // ANALYTICS - CLICKS DE COMPRA
        // ============================================

        function renderAnalytics() {
            const container = document.getElementById('analytics-container');
            container.innerHTML = '';

            const entries = Object.entries(proyectosData);
            if (entries.length === 0) {
                container.innerHTML = '<p style="color:#888;text-align:center;padding:20px;">Sin proyectos</p>';
                return;
            }

            const limiteDias = parseInt(document.getElementById('filtro-dias')?.value || 30);
            const hoy = new Date();

            // Ordenar proyectos por total de clicks (mayor a menor)
            entries.sort((a, b) => {
                const ta = Object.values(a[1].clics_por_dia || {}).reduce((s,v)=>s+v,0);
                const tb = Object.values(b[1].clics_por_dia || {}).reduce((s,v)=>s+v,0);
                return tb - ta;
            });

            entries.forEach(([id, proyecto]) => {
                const diasData = proyecto.clics_por_dia || {};
                const hoyStr = hoy.toISOString().split('T')[0];

                // Filtrar d√≠as seg√∫n el per√≠odo seleccionado
                let diasFiltrados = Object.entries(diasData);
                if (limiteDias > 0) {
                    const limite = new Date(hoy);
                    limite.setDate(limite.getDate() - limiteDias);
                    diasFiltrados = diasFiltrados.filter(([fecha]) => new Date(fecha) >= limite);
                }

                // Ordenar por fecha m√°s reciente primero
                diasFiltrados.sort((a, b) => b[0].localeCompare(a[0]));

                const total = Object.values(diasData).reduce((s,v) => s+v, 0);
                const hoyClicks = diasData[hoyStr] || 0;
                const maxDia = Math.max(...diasFiltrados.map(([,v]) => v), 1);

                const card = document.createElement('div');
                card.className = 'analytics-proyecto abierto';
                card.setAttribute('data-id', id);

                let filasHTML = '';
                if (diasFiltrados.length === 0) {
                    filasHTML = `<tr><td colspan="3" class="sin-datos-dia">Sin clicks en este per√≠odo</td></tr>`;
                } else {
                    diasFiltrados.forEach(([fecha, num]) => {
                        const pct = Math.round((num / maxDia) * 100);
                        const esHoy = fecha === hoyStr;
                        filasHTML += `
                            <tr>
                                <td class="dia-fecha">${esHoy ? '‚≠ê Hoy' : formatearFecha(fecha)}</td>
                                <td class="dia-barra-wrap">
                                    <div class="dia-barra-bg">
                                        <div class="dia-barra" style="width:${pct}%"></div>
                                    </div>
                                </td>
                                <td class="dia-num">${num}</td>
                            </tr>
                        `;
                    });
                }

                card.innerHTML = `
                    <div class="analytics-header" onclick="toggleAnalytics('${id}')">
                        <div class="analytics-proyecto-nombre">üåê ${proyecto.nombre}</div>
                        <div class="analytics-badges">
                            <span class="badge-hoy">Hoy: ${hoyClicks}</span>
                            <span class="badge-total">Total: ${total}</span>
                            <button class="click-reset-btn" onclick="event.stopPropagation(); resetClicks('${id}')">üóë Reset</button>
                            <span class="toggle-arrow">‚ñº</span>
                        </div>
                    </div>
                    <div class="analytics-body">
                        <table class="dias-tabla">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Clicks</th>
                                    <th style="text-align:right;">Total</th>
                                </tr>
                            </thead>
                            <tbody>${filasHTML}</tbody>
                        </table>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function toggleAnalytics(id) {
            const card = document.querySelector(`.analytics-proyecto[data-id="${id}"]`);
            if (card) card.classList.toggle('abierto');
            const body = card?.querySelector('.analytics-body');
            if (body) body.style.display = card.classList.contains('abierto') ? 'block' : 'none';
        }

        function formatearFecha(fechaStr) {
            const [y, m, d] = fechaStr.split('-');
            const meses = ['Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov','Dic'];
            return `${d} ${meses[parseInt(m)-1]} ${y}`;
        }

        function resetClicks(id) {
            const nombre = proyectosData[id].nombre;
            if (!confirm(`¬øResetear TODOS los clicks de "${nombre}"?`)) return;
            proyectosData[id].clics_por_dia = {};
            proyectosData[id].clics_compra = 0;
            proyectosData[id].ultima_actualizacion = new Date().toISOString().split('T')[0];
            agregarLog(`üóë Clicks reseteados: ${nombre}`);
            guardarCambios();
            renderAnalytics();
            actualizarEstadisticas(proyectosData);
            alert(`‚úÖ Clicks de "${nombre}" reseteados`);
        }

        // ============================================
        // GESTI√ìN DE USUARIOS
        // ============================================

        async function agregarUsuario() {
            const usu = document.getElementById('nuevo-usuario').value.trim();
            const pass = document.getElementById('nueva-contrasena').value;
            const pass2 = document.getElementById('repetir-contrasena').value;
            const msg = document.getElementById('msg-usuarios');

            const mostrarMsg = (texto, color) => {
                msg.style.display = 'block';
                msg.style.background = color === 'ok' ? 'rgba(0,255,65,0.15)' : 'rgba(255,0,110,0.15)';
                msg.style.border = `1px solid ${color === 'ok' ? 'var(--success)' : 'var(--danger)'}`;
                msg.style.color = color === 'ok' ? 'var(--success)' : 'var(--danger)';
                msg.textContent = texto;
                setTimeout(() => msg.style.display = 'none', 3000);
            };

            if (!usu || !pass) return mostrarMsg('‚ö†Ô∏è Completa todos los campos', 'err');
            if (pass !== pass2) return mostrarMsg('‚ùå Las contrase√±as no coinciden', 'err');
            if (pass.length < 6) return mostrarMsg('‚ùå La contrase√±a debe tener al menos 6 caracteres', 'err');

            const hUser = await _sha256(usu);
            const hPass = await _sha256(pass);

            // No permitir sobreescribir el admin principal
            if (_h[hUser]) return mostrarMsg('‚ö†Ô∏è Ese usuario ya existe como admin principal', 'err');

            const extras = JSON.parse(localStorage.getItem('_usuarios_extras') || '{}');
            extras[hUser] = hPass;
            localStorage.setItem('_usuarios_extras', JSON.stringify(extras));

            // Guardar nombre visible (no la contrase√±a)
            const nombres = JSON.parse(localStorage.getItem('_usuarios_nombres') || '{}');
            nombres[hUser] = usu;
            localStorage.setItem('_usuarios_nombres', JSON.stringify(nombres));

            document.getElementById('nuevo-usuario').value = '';
            document.getElementById('nueva-contrasena').value = '';
            document.getElementById('repetir-contrasena').value = '';

            mostrarMsg(`‚úÖ Usuario "${usu}" guardado correctamente`, 'ok');
            agregarLog(`üë§ Nuevo usuario agregado: ${usu}`);
            renderUsuarios();
        }

        function renderUsuarios() {
            const lista = document.getElementById('lista-usuarios');
            lista.innerHTML = '';

            const extras = JSON.parse(localStorage.getItem('_usuarios_extras') || '{}');
            const nombres = JSON.parse(localStorage.getItem('_usuarios_nombres') || '{}');

            // Usuario principal (hardcoded)
            const rowAdmin = document.createElement('div');
            rowAdmin.className = 'click-row';
            rowAdmin.style.cssText = 'display:flex; align-items:center; gap:15px; padding:16px; background:rgba(189,0,255,0.05); border:1px solid var(--gray); border-radius:10px; margin-bottom:10px;';
            rowAdmin.innerHTML = `
                <span style="font-size:1.3rem;">üëë</span>
                <div style="flex:1;">
                    <div style="font-weight:700; color:#fff;">TORRES</div>
                    <div style="color:#888; font-size:0.8rem;">Admin principal ¬∑ Contrase√±a protegida</div>
                </div>
                <span style="padding:5px 12px; background:rgba(189,0,255,0.2); border:1px solid var(--info); color:var(--info); border-radius:6px; font-size:0.8rem;">üîí Fijo</span>
            `;
            lista.appendChild(rowAdmin);

            // Usuarios extras
            const entradas = Object.entries(extras);
            if (entradas.length === 0) {
                const p = document.createElement('p');
                p.style.cssText = 'color:#555; font-size:0.9rem; margin-top:15px;';
                p.textContent = 'No hay usuarios adicionales a√∫n.';
                lista.appendChild(p);
                return;
            }

            entradas.forEach(([hUser]) => {
                const nombre = nombres[hUser] || '(usuario)';
                const div = document.createElement('div');
                div.style.cssText = 'display:flex; align-items:center; gap:15px; padding:16px; background:rgba(255,255,255,0.02); border:1px solid var(--gray); border-radius:10px; margin-bottom:10px;';
                div.innerHTML = `
                    <span style="font-size:1.3rem;">üë§</span>
                    <div style="flex:1;">
                        <div style="font-weight:700; color:#fff;">${nombre}</div>
                        <div style="color:#888; font-size:0.8rem;">Contrase√±a: ‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢ (protegida)</div>
                    </div>
                    <button onclick="eliminarUsuario('${hUser}', '${nombre}')" style="padding:6px 14px; background:rgba(255,0,110,0.15); border:1px solid var(--danger); color:var(--danger); border-radius:6px; cursor:pointer; font-weight:600; font-size:0.85rem;">
                        üóë Eliminar
                    </button>
                `;
                lista.appendChild(div);
            });
        }

        function eliminarUsuario(hUser, nombre) {
            if (!confirm(`¬øEliminar el usuario "${nombre}"?`)) return;
            const extras = JSON.parse(localStorage.getItem('_usuarios_extras') || '{}');
            const nombres = JSON.parse(localStorage.getItem('_usuarios_nombres') || '{}');
            delete extras[hUser];
            delete nombres[hUser];
            localStorage.setItem('_usuarios_extras', JSON.stringify(extras));
            localStorage.setItem('_usuarios_nombres', JSON.stringify(nombres));
            agregarLog(`üóë Usuario eliminado: ${nombre}`);
            renderUsuarios();
        }

        // ============================================
        // GESTI√ìN DE PROYECTOS - CREAR NUEVO
        // ============================================

        function abrirModalNuevoProyecto() {
            // Fecha por defecto: 30 d√≠as desde hoy
            const hoy = new Date();
            hoy.setDate(hoy.getDate() + 30);
            document.getElementById('np-expira').value = hoy.toISOString().split('T')[0];
            document.getElementById('np-msg').style.display = 'none';
            document.getElementById('modalNuevoProyecto').classList.add('active');
        }

        function cerrarModalNuevoProyecto() {
            document.getElementById('modalNuevoProyecto').classList.remove('active');
            ['np-id','np-nombre','np-cliente','np-url','np-precio'].forEach(id => {
                document.getElementById(id).value = '';
            });
        }

        function guardarNuevoProyecto() {
            const id      = document.getElementById('np-id').value.trim().replace(/\s+/g, '_');
            const nombre  = document.getElementById('np-nombre').value.trim();
            const cliente = document.getElementById('np-cliente').value.trim();
            const url     = document.getElementById('np-url').value.trim();
            const precio  = document.getElementById('np-precio').value.trim();
            const expira  = document.getElementById('np-expira').value;
            const activo  = document.getElementById('np-activo').checked;
            const pagado  = document.getElementById('np-pagado').checked;

            const msg = document.getElementById('np-msg');
            const mostrarMsg = (txt, tipo) => {
                msg.style.display = 'block';
                msg.style.background = tipo === 'ok' ? 'rgba(0,255,65,0.15)' : 'rgba(255,0,110,0.15)';
                msg.style.border = `1px solid ${tipo === 'ok' ? 'var(--success)' : 'var(--danger)'}`;
                msg.style.color = tipo === 'ok' ? 'var(--success)' : 'var(--danger)';
                msg.textContent = txt;
            };

            if (!id || !nombre || !expira) {
                return mostrarMsg('‚ö†Ô∏è ID, nombre y fecha de expiraci√≥n son obligatorios', 'err');
            }
            if (proyectosData[id]) {
                return mostrarMsg(`‚ö†Ô∏è Ya existe un proyecto con ID "${id}"`, 'err');
            }

            proyectosData[id] = {
                nombre: nombre,
                cliente: cliente || 'Sin especificar',
                url_demo: url || '#',
                precio: precio || 'Sin precio',
                expira: expira,
                activo: activo,
                pagado: pagado,
                mantenimiento: false,
                ultima_actualizacion: new Date().toISOString().split('T')[0],
                clics_compra: 0,
                clics_por_dia: {}
            };

            mostrarMsg('üíæ Guardando en Firebase...', 'ok');
            agregarLog(`‚ûï Nuevo proyecto creado: ${nombre} (${id})`);

            guardarCambios();
            setTimeout(() => {
                cerrarModalNuevoProyecto();
            }, 1500);
        }

    </script>
</body>
</html>
