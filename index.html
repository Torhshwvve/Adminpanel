<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ Panel Admin - Control de Proyectos</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #00d9ff;
            --success: #00ff41;
            --danger: #ff006e;
            --warning: #ff6b00;
            --dark: #0a0a0a;
            --card-bg: #1a1a1a;
            --gray: #2a2a2a;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--dark);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(0, 217, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 255, 65, 0.1) 0%, transparent 50%);
        }

        /* Login Screen */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--dark);
            z-index: 9999;
        }

        .login-box {
            background: var(--card-bg);
            padding: 50px 40px;
            border-radius: 20px;
            border: 1px solid rgba(0, 217, 255, 0.3);
            max-width: 400px;
            width: 100%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .login-logo {
            font-size: 4rem;
            margin-bottom: 20px;
            filter: drop-shadow(0 0 20px rgba(0, 217, 255, 0.5));
        }

        .login-title {
            font-size: 2rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--primary), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .login-subtitle {
            color: #888;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #ccc;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .form-input {
            width: 100%;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #fff;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 10px rgba(0, 217, 255, 0.3);
        }

        .btn-login {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--primary), var(--success));
            border: none;
            border-radius: 8px;
            color: #000;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s;
            margin-top: 10px;
        }

        .btn-login:hover {
            transform: translateY(-2px);
        }

        .error-msg {
            background: rgba(255, 0, 110, 0.2);
            border: 1px solid var(--danger);
            color: var(--danger);
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }

        /* Main Panel */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: none;
        }

        .container.active {
            display: block;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding: 30px;
            background: linear-gradient(135deg, rgba(0, 217, 255, 0.1) 0%, rgba(0, 255, 65, 0.1) 100%);
            border-radius: 15px;
            border: 1px solid rgba(0, 217, 255, 0.2);
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-left h1 {
            font-size: 2rem;
            background: linear-gradient(135deg, var(--primary), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-right {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .user-info {
            padding: 10px 20px;
            background: rgba(0, 217, 255, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(0, 217, 255, 0.3);
        }

        .btn-logout {
            padding: 10px 20px;
            background: rgba(255, 0, 110, 0.2);
            border: 1px solid var(--danger);
            color: var(--danger);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-logout:hover {
            background: rgba(255, 0, 110, 0.3);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid var(--gray);
            text-align: center;
        }

        .stat-number {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #888;
            text-transform: uppercase;
            font-size: 0.9rem;
        }

        .proyecto {
            background: var(--card-bg);
            padding: 30px;
            margin-bottom: 25px;
            border-radius: 15px;
            border-left: 5px solid;
        }

        .proyecto.activo {
            border-left-color: var(--success);
        }

        .proyecto.inactivo {
            border-left-color: var(--danger);
        }

        .proyecto-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .proyecto-titulo {
            font-size: 1.8rem;
            font-weight: bold;
        }

        .badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge.activo {
            background: rgba(0, 255, 65, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .badge.inactivo {
            background: rgba(255, 0, 110, 0.2);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .proyecto-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .info-item {
            padding: 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
        }

        .info-label {
            color: #888;
            font-size: 0.85rem;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .controles {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-activar {
            background: linear-gradient(135deg, var(--success), #00cc33);
            color: #000;
        }

        .btn-desactivar {
            background: linear-gradient(135deg, var(--danger), #cc0055);
            color: #fff;
        }

        .btn-tiempo {
            background: linear-gradient(135deg, var(--primary), #0080ff);
            color: #fff;
        }

        .btn-editar {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            padding: 40px;
            border-radius: 15px;
            border: 1px solid rgba(0, 217, 255, 0.3);
            max-width: 500px;
            width: 90%;
        }

        .modal-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: var(--primary);
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .tiempo-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .tiempo-option {
            padding: 15px;
            background: rgba(0, 217, 255, 0.1);
            border: 1px solid rgba(0, 217, 255, 0.3);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tiempo-option:hover {
            background: rgba(0, 217, 255, 0.2);
            transform: scale(1.05);
        }

        /* Firebase Status Bar */
        #firebase-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 18px;
            border-radius: 30px;
            font-size: 0.85rem;
            font-weight: 600;
            z-index: 9999;
            transition: all 0.4s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        #firebase-status.conectado {
            background: rgba(0, 255, 65, 0.15);
            border: 1px solid rgba(0, 255, 65, 0.5);
            color: #00ff41;
        }
        #firebase-status.guardando {
            background: rgba(0, 217, 255, 0.15);
            border: 1px solid rgba(0, 217, 255, 0.5);
            color: #00d9ff;
        }
        #firebase-status.error {
            background: rgba(255, 0, 110, 0.15);
            border: 1px solid rgba(255, 0, 110, 0.5);
            color: #ff006e;
        }
        .pulse-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
            animation: pulsar 1.5s infinite;
        }
        @keyframes pulsar {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.4; transform: scale(0.7); }
        }

        @media (max-width: 768px) {
            header {
                flex-direction: column;
                text-align: center;
            }

            .proyecto-header {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Firebase Status -->
    <div id="firebase-status" class="error">
        <div class="pulse-dot"></div>
        <span id="firebase-status-text">‚öôÔ∏è Configurar Firebase</span>
    </div>

    <!-- Login Screen -->
    <div class="login-container" id="loginScreen">
        <div class="login-box">
            <div class="login-logo">üéÆ</div>
            <h1 class="login-title">Panel Admin</h1>
            <p class="login-subtitle">Control de Proyectos Web</p>
            
            <form id="loginForm" onsubmit="return login(event)">
                <div class="form-group">
                    <label class="form-label">Usuario</label>
                    <input type="text" id="username" class="form-input" placeholder="Ingresa tu usuario" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Contrase√±a</label>
                    <input type="password" id="password" class="form-input" placeholder="Ingresa tu contrase√±a" required>
                </div>
                
                <button type="submit" class="btn-login">üîì Acceder</button>
                
                <div class="error-msg" id="errorMsg">
                    ‚ùå Usuario o contrase√±a incorrectos
                </div>
            </form>
        </div>
    </div>

    <!-- Main Panel -->
    <div class="container" id="mainPanel">
        <header>
            <div class="header-left">
                <h1>üéÆ Panel de Control de Proyectos</h1>
                <p style="color: #888;">Sistema de gesti√≥n y protecci√≥n</p>
            </div>
            <div class="header-right">
                <div class="user-info">
                    üë§ Usuario: <strong id="currentUser">TORRES</strong>
                </div>
                <button class="btn-logout" onclick="logout()">üö™ Cerrar Sesi√≥n</button>
            </div>
        </header>

        <div class="stats" id="stats">
            <div class="stat-card">
                <div class="stat-number" id="total-proyectos">0</div>
                <div class="stat-label">Total Proyectos</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" style="color: var(--success);" id="activos">0</div>
                <div class="stat-label">Activos</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" style="color: var(--danger);" id="inactivos">0</div>
                <div class="stat-label">Inactivos</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" style="color: var(--warning);" id="sin-pagar">0</div>
                <div class="stat-label">Sin Pagar</div>
            </div>
        </div>

        <div id="proyectos-lista"></div>
    </div>

    <!-- Modal para agregar tiempo -->
    <div class="modal" id="modalTiempo">
        <div class="modal-content">
            <h2 class="modal-title">‚è∞ Agregar Tiempo</h2>
            <p style="color: #888; margin-bottom: 20px;">Selecciona cu√°nto tiempo agregar a <strong id="proyectoNombre"></strong></p>
            
            <div class="tiempo-selector">
                <div class="tiempo-option" onclick="agregarTiempo(7)">
                    <div style="font-size: 2rem;">üìÖ</div>
                    <div>7 d√≠as</div>
                </div>
                <div class="tiempo-option" onclick="agregarTiempo(15)">
                    <div style="font-size: 2rem;">üìÖ</div>
                    <div>15 d√≠as</div>
                </div>
                <div class="tiempo-option" onclick="agregarTiempo(30)">
                    <div style="font-size: 2rem;">üìÖ</div>
                    <div>1 mes</div>
                </div>
                <div class="tiempo-option" onclick="agregarTiempo(60)">
                    <div style="font-size: 2rem;">üìÖ</div>
                    <div>2 meses</div>
                </div>
                <div class="tiempo-option" onclick="agregarTiempo(90)">
                    <div style="font-size: 2rem;">üìÖ</div>
                    <div>3 meses</div>
                </div>
                <div class="tiempo-option" onclick="agregarTiempo(180)">
                    <div style="font-size: 2rem;">üìÖ</div>
                    <div>6 meses</div>
                </div>
            </div>

            <div style="margin-top: 20px;">
                <label class="form-label">O ingresa d√≠as personalizados:</label>
                <input type="number" id="diasCustom" class="form-input" placeholder="Ej: 45" min="1">
            </div>

            <div class="modal-buttons">
                <button class="btn btn-tiempo" onclick="agregarTiempoCustom()">‚úì Confirmar</button>
                <button class="btn btn-editar" onclick="cerrarModal()">‚úó Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // üî• CONFIGURACI√ìN FIREBASE (EDITAR AQU√ç)
        // ============================================
        const FIREBASE_CONFIG = {
            // 1. Ve a https://console.firebase.google.com
            // 2. Crea proyecto ‚Üí Realtime Database ‚Üí Crear base de datos
            // 3. Ve a Configuraci√≥n del proyecto ‚Üí Cuentas de servicio ‚Üí Secretos de base de datos
            // 4. Copia la URL y el Secret abajo:
            
            dbURL: 'https://alexis-fba4d-default-rtdb.firebaseio.com',
            // ‚úÖ URL configurada correctamente
            
            secret: 'tUF8DBEqtW1o3fIq5YZfceoLOYWbGw83eebXnj6N'
            // ‚úÖ Secret token configurado correctamente
        };
        // ¬øYa configuraste Firebase? ‚Üí Cambia los valores de arriba y guarda el archivo
        // ============================================

        // ============================================
        // CONFIGURACI√ìN DE SEGURIDAD
        // ============================================
        const AUTH = {
            user: atob('VE9SUkVT'),      // TORRES
            pass: atob('QUxFWElTMjAyMA==') // ALEXIS2020
        };

        // ============================================
        // VARIABLES GLOBALES
        // ============================================
        let proyectosData = null;
        let proyectoActual = null;
        const DB_URL = FIREBASE_CONFIG.dbURL + '/proyectos';

        // ============================================
        // SISTEMA DE ESTADO FIREBASE
        // ============================================
        function setStatus(tipo, texto) {
            const el = document.getElementById('firebase-status');
            const txt = document.getElementById('firebase-status-text');
            el.className = '';
            el.classList.add(tipo);
            txt.textContent = texto;
        }

        // ============================================
        // SISTEMA DE AUTENTICACI√ìN
        // ============================================
        window.addEventListener('DOMContentLoaded', function() {
            verificarFirebaseConfig();
            if (sessionStorage.getItem('admin_logged') === 'true') {
                mostrarPanel();
            }
        });

        function verificarFirebaseConfig() {
            if (FIREBASE_CONFIG.dbURL.includes('TU-PROYECTO') || 
                FIREBASE_CONFIG.secret.includes('TU_DATABASE_SECRET')) {
                setStatus('error', '‚ö†Ô∏è Firebase no configurado');
            } else {
                setStatus('guardando', 'üîÑ Conectando a Firebase...');
            }
        }

        function login(event) {
            event.preventDefault();
            const usuario = document.getElementById('username').value;
            const contrase√±a = document.getElementById('password').value;
            
            if (usuario === AUTH.user && contrase√±a === AUTH.pass) {
                sessionStorage.setItem('admin_logged', 'true');
                mostrarPanel();
                return false;
            }
            document.getElementById('errorMsg').style.display = 'block';
            document.getElementById('password').value = '';
            setTimeout(() => {
                document.getElementById('errorMsg').style.display = 'none';
            }, 3000);
            return false;
        }

        function logout() {
            sessionStorage.removeItem('admin_logged');
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('mainPanel').classList.remove('active');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        function mostrarPanel() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainPanel').classList.add('active');
            cargarProyectos();
        }

        // ============================================
        // üî• GESTI√ìN DE PROYECTOS - FIREBASE
        // ============================================

        function cargarProyectos() {
            // Si Firebase no est√° configurado, usar archivo local
            if (FIREBASE_CONFIG.dbURL.includes('TU-PROYECTO')) {
                setStatus('error', '‚ö†Ô∏è Configura Firebase para tiempo real');
                cargarProyectosLocal();
                return;
            }

            setStatus('guardando', 'üîÑ Cargando datos...');

            fetch(DB_URL + '.json?t=' + Date.now())
                .then(r => {
                    if (!r.ok) throw new Error('HTTP ' + r.status);
                    return r.json();
                })
                .then(data => {
                    if (!data) throw new Error('Base de datos vac√≠a - inicializa los datos primero');
                    proyectosData = data;
                    renderProyectos(data);
                    actualizarEstadisticas(data);
                    setStatus('conectado', 'üü¢ Firebase conectado (tiempo real)');
                })
                .catch(error => {
                    setStatus('error', '‚ùå Error: ' + error.message);
                    console.warn('Firebase error, cargando local:', error);
                    cargarProyectosLocal();
                });
        }

        function cargarProyectosLocal() {
            fetch('proyectos.json?t=' + Date.now())
                .then(r => r.json())
                .then(data => {
                    proyectosData = data;
                    renderProyectos(data);
                    actualizarEstadisticas(data);
                    if (FIREBASE_CONFIG.dbURL.includes('TU-PROYECTO')) {
                        setStatus('error', '‚ö†Ô∏è Modo local - Configura Firebase para tiempo real');
                    }
                })
                .catch(error => {
                    setStatus('error', '‚ùå Error al cargar: ' + error.message);
                });
        }

        // ============================================
        // üî• GUARDAR EN FIREBASE (TIEMPO REAL)
        // ============================================
        function guardarCambios() {
            // Si Firebase no configurado, mostrar modal de copia manual (modo offline)
            if (FIREBASE_CONFIG.dbURL.includes('TU-PROYECTO') || 
                FIREBASE_CONFIG.secret.includes('TU_DATABASE_SECRET')) {
                guardarCambiosManual();
                return;
            }

            setStatus('guardando', 'üíæ Guardando en tiempo real...');

            fetch(DB_URL + '.json?auth=' + FIREBASE_CONFIG.secret, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(proyectosData)
            })
            .then(r => {
                if (!r.ok) throw new Error('HTTP ' + r.status + ' - Verifica el secret de Firebase');
                return r.json();
            })
            .then(() => {
                setStatus('conectado', '‚úÖ Guardado! Sitios actualizados al instante');
                renderProyectos(proyectosData);
                actualizarEstadisticas(proyectosData);
                // Volver a estado normal despu√©s de 3 segundos
                setTimeout(() => setStatus('conectado', 'üü¢ Firebase conectado (tiempo real)'), 3000);
            })
            .catch(error => {
                setStatus('error', '‚ùå Error al guardar: ' + error.message);
                console.error('Error Firebase:', error);
                // Fallback: ofrecer copia manual
                if (confirm('Error al guardar en Firebase.\n¬øDeseas copiar el JSON manualmente?')) {
                    guardarCambiosManual();
                }
            });
        }

        function guardarCambiosManual() {
            const jsonStr = JSON.stringify(proyectosData, null, 2);
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 700px;">
                    <h2 class="modal-title">üìù Actualizar proyectos.json</h2>
                    <p style="color: #ff006e; margin-bottom: 10px;">
                        ‚ö†Ô∏è Firebase no configurado. Copia este JSON manualmente:
                    </p>
                    <p style="color: #888; margin-bottom: 20px;">
                        Actualiza el archivo <strong>proyectos.json</strong> en tu repositorio de GitHub.
                    </p>
                    <textarea id="jsonOutput" style="width: 100%; height: 300px; background: #000; color: #0f0; 
                        padding: 15px; border-radius: 8px; border: 1px solid #333; font-family: monospace; 
                        font-size: 0.9rem;" readonly>${jsonStr}</textarea>
                    <div class="modal-buttons" style="margin-top: 20px;">
                        <button class="btn btn-tiempo" onclick="copiarJSON()">üìã Copiar</button>
                        <button class="btn btn-editar" onclick="cerrarModalGuardar()">‚úì Cerrar</button>
                    </div>
                    <p style="color: #666; font-size: 0.85rem; margin-top: 15px;">
                        üí° Configura Firebase para guardar autom√°ticamente en tiempo real
                    </p>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // ============================================
        // RENDER Y ESTAD√çSTICAS
        // ============================================

        function renderProyectos(proyectos) {
            const lista = document.getElementById('proyectos-lista');
            lista.innerHTML = '';

            for (let [id, proyecto] of Object.entries(proyectos)) {
                const expira = new Date(proyecto.expira);
                const hoy = new Date();
                const diasRestantes = Math.ceil((expira - hoy) / (1000 * 60 * 60 * 24));
                
                const div = document.createElement('div');
                div.className = `proyecto ${proyecto.activo ? 'activo' : 'inactivo'}`;
                div.innerHTML = `
                    <div class="proyecto-header">
                        <div>
                            <div class="proyecto-titulo">${proyecto.nombre}</div>
                            <div style="color: #888; margin-top: 5px;">Cliente: ${proyecto.cliente} ‚Ä¢ ID: ${id}</div>
                        </div>
                        <span class="badge ${proyecto.activo ? 'activo' : 'inactivo'}">
                            ${proyecto.activo ? '‚úÖ Activo' : '‚ùå Inactivo'}
                        </span>
                    </div>

                    <div class="proyecto-info">
                        <div class="info-item">
                            <div class="info-label">üí∞ Precio</div>
                            <div class="info-value">${proyecto.precio}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">üí≥ Estado Pago</div>
                            <div class="info-value" style="color: ${proyecto.pagado ? 'var(--success)' : 'var(--danger)'};">
                                ${proyecto.pagado ? 'Pagado ‚úì' : 'Pendiente ‚úó'}
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">üìÖ Expira</div>
                            <div class="info-value">
                                ${proyecto.expira}
                                <div style="font-size: 0.85rem; color: ${diasRestantes <= 7 ? 'var(--warning)' : '#888'};">
                                    ${diasRestantes > 0 ? `(${diasRestantes} d√≠as restantes)` : '(Expirado)'}
                                </div>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">üîÑ Actualizado</div>
                            <div class="info-value">${proyecto.ultima_actualizacion}</div>
                        </div>
                    </div>

                    <div class="controles">
                        <button class="btn ${proyecto.activo ? 'btn-desactivar' : 'btn-activar'}" 
                                onclick="toggleActivacion('${id}', ${!proyecto.activo})">
                            ${proyecto.activo ? 'üî¥ Desactivar Sitio' : 'üü¢ Activar Sitio'}
                        </button>
                        <button class="btn btn-tiempo" onclick="abrirModalTiempo('${id}')">
                            ‚è∞ Agregar Tiempo
                        </button>
                        <button class="btn btn-editar" onclick="togglePago('${id}', ${!proyecto.pagado})">
                            ${proyecto.pagado ? 'üí≥ Marcar No Pagado' : 'üí∞ Marcar Pagado'}
                        </button>
                        <a href="${proyecto.url_demo}" class="btn btn-editar" target="_blank" style="text-decoration: none;">
                            üåê Ver Sitio
                        </a>
                    </div>
                `;
                lista.appendChild(div);
            }
        }

        function actualizarEstadisticas(proyectos) {
            const total = Object.keys(proyectos).length;
            let activos = 0, inactivos = 0, sinPagar = 0;
            for (let p of Object.values(proyectos)) {
                if (p.activo) activos++; else inactivos++;
                if (!p.pagado) sinPagar++;
            }
            document.getElementById('total-proyectos').textContent = total;
            document.getElementById('activos').textContent = activos;
            document.getElementById('inactivos').textContent = inactivos;
            document.getElementById('sin-pagar').textContent = sinPagar;
        }

        // ============================================
        // FUNCIONES DE CONTROL
        // ============================================

        function toggleActivacion(id, nuevoEstado) {
            const proyecto = proyectosData[id];
            const accion = nuevoEstado ? 'activar' : 'desactivar';
            if (confirm(`¬øEst√°s seguro de ${accion} el sitio "${proyecto.nombre}"?`)) {
                proyectosData[id].activo = nuevoEstado;
                proyectosData[id].ultima_actualizacion = new Date().toISOString().split('T')[0];
                guardarCambios();
            }
        }

        function togglePago(id, nuevoPago) {
            proyectosData[id].pagado = nuevoPago;
            proyectosData[id].ultima_actualizacion = new Date().toISOString().split('T')[0];
            guardarCambios();
        }

        function abrirModalTiempo(id) {
            proyectoActual = id;
            document.getElementById('proyectoNombre').textContent = proyectosData[id].nombre;
            document.getElementById('modalTiempo').classList.add('active');
        }

        function cerrarModal() {
            document.getElementById('modalTiempo').classList.remove('active');
            document.getElementById('diasCustom').value = '';
        }

        function agregarTiempo(dias) {
            if (!proyectoActual) return;
            const proyecto = proyectosData[proyectoActual];
            const fechaActual = new Date(proyecto.expira);
            fechaActual.setDate(fechaActual.getDate() + dias);
            proyectosData[proyectoActual].expira = fechaActual.toISOString().split('T')[0];
            proyectosData[proyectoActual].ultima_actualizacion = new Date().toISOString().split('T')[0];
            cerrarModal();
            guardarCambios();
            alert(`‚úÖ Se agregaron ${dias} d√≠as a ${proyecto.nombre}\nNueva fecha: ${fechaActual.toLocaleDateString('es-ES')}`);
        }

        function agregarTiempoCustom() {
            const dias = parseInt(document.getElementById('diasCustom').value);
            if (dias && dias > 0) {
                agregarTiempo(dias);
            } else {
                alert('‚ö†Ô∏è Ingresa un n√∫mero v√°lido de d√≠as');
            }
        }

        function copiarJSON() {
            const textarea = document.getElementById('jsonOutput');
            textarea.select();
            document.execCommand('copy');
            alert('‚úÖ JSON copiado al portapapeles');
        }

        function cerrarModalGuardar() {
            const modal = document.querySelector('.modal.active:last-of-type');
            if (modal) modal.remove();
            cargarProyectos();
        }
    </script>
</body>
</html>
